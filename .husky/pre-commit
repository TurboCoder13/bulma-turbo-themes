# Run quick CI checks before commit
echo "üîç Running pre-commit CI checks..."

# Run linting and formatting
npm run lint
npm run format

# Run theme sync to ensure deterministic generation
npm run theme:sync

# Check for non-deterministic changes in generated files only
GENERATED_PATHS="src/themes/packs/catppuccin.synced.ts"
if ! git diff --quiet -- $GENERATED_PATHS || [ -n "$(git ls-files --others --exclude-standard -- $GENERATED_PATHS)" ]; then
  echo "‚ùå Theme sync generated changes in generated files. Please commit them:"
  git --no-pager diff -- $GENERATED_PATHS | cat
  git ls-files --others --exclude-standard -- $GENERATED_PATHS || true
  exit 1
fi

# Run TypeScript build
npm run build

# Run tests
npm test --silent

echo "‚úÖ Pre-commit checks passed!"