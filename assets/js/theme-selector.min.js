"use strict";const I={bulma:{name:"Bulma",description:"Classic Bulma themes"},catppuccin:{name:"Catppuccin",description:"Soothing pastel themes"},github:{name:"GitHub",description:"GitHub-inspired themes"},dracula:{name:"Dracula",description:"Dark vampire aesthetic"}},x=[{id:"bulma-light",name:"Light",description:"Classic Bulma look with a bright, neutral palette.",cssFile:"assets/css/themes/bulma-light.css",icon:"assets/img/bulma-logo.webp",iconFallback:"assets/img/bulma-logo.png",family:"bulma",appearance:"light",colors:{bg:"#ffffff",surface:"#f5f5f5",accent:"#00d1b2",text:"#363636"}},{id:"bulma-dark",name:"Dark",description:"Dark Bulma theme tuned for low-light reading.",cssFile:"assets/css/themes/bulma-dark.css",icon:"assets/img/bulma-logo.webp",iconFallback:"assets/img/bulma-logo.png",family:"bulma",appearance:"dark",colors:{bg:"#1a1a2e",surface:"#252540",accent:"#00d1b2",text:"#f5f5f5"}},{id:"catppuccin-latte",name:"Latte",description:"Light, soft Catppuccin palette for daytime use.",cssFile:"assets/css/themes/catppuccin-latte.css",icon:"assets/img/catppuccin-logo-latte.webp",iconFallback:"assets/img/catppuccin-logo-latte.png",family:"catppuccin",appearance:"light",colors:{bg:"#eff1f5",surface:"#e6e9ef",accent:"#8839ef",text:"#4c4f69"}},{id:"catppuccin-frappe",name:"Frapp\xE9",description:"Balanced dark Catppuccin theme for focused work.",cssFile:"assets/css/themes/catppuccin-frappe.css",icon:"assets/img/catppuccin-logo-latte.webp",iconFallback:"assets/img/catppuccin-logo-latte.png",family:"catppuccin",appearance:"dark",colors:{bg:"#303446",surface:"#414559",accent:"#ca9ee6",text:"#c6d0f5"}},{id:"catppuccin-macchiato",name:"Macchiato",description:"Deep, atmospheric Catppuccin variant with rich contrast.",cssFile:"assets/css/themes/catppuccin-macchiato.css",icon:"assets/img/catppuccin-logo-macchiato.webp",iconFallback:"assets/img/catppuccin-logo-macchiato.png",family:"catppuccin",appearance:"dark",colors:{bg:"#24273a",surface:"#363a4f",accent:"#c6a0f6",text:"#cad3f5"}},{id:"catppuccin-mocha",name:"Mocha",description:"Cozy, high-contrast Catppuccin theme for late-night sessions.",cssFile:"assets/css/themes/catppuccin-mocha.css",icon:"assets/img/catppuccin-logo-macchiato.webp",iconFallback:"assets/img/catppuccin-logo-macchiato.png",family:"catppuccin",appearance:"dark",colors:{bg:"#1e1e2e",surface:"#313244",accent:"#cba6f7",text:"#cdd6f4"}},{id:"dracula",name:"Classic",description:"Iconic Dracula dark theme with vibrant accents.",cssFile:"assets/css/themes/dracula.css",icon:"assets/img/dracula-logo.webp",iconFallback:"assets/img/dracula-logo.png",family:"dracula",appearance:"dark",colors:{bg:"#282a36",surface:"#44475a",accent:"#bd93f9",text:"#f8f8f2"}},{id:"github-light",name:"Light",description:"GitHub-inspired light theme suited for documentation and UI heavy pages.",cssFile:"assets/css/themes/github-light.css",icon:"assets/img/github-logo-light.webp",iconFallback:"assets/img/github-logo-light.png",family:"github",appearance:"light",colors:{bg:"#ffffff",surface:"#f6f8fa",accent:"#0969da",text:"#1f2328"}},{id:"github-dark",name:"Dark",description:"GitHub dark theme optimized for code-heavy views.",cssFile:"assets/css/themes/github-dark.css",icon:"assets/img/github-logo-dark.webp",iconFallback:"assets/img/github-logo-dark.png",family:"github",appearance:"dark",colors:{bg:"#0d1117",surface:"#161b22",accent:"#58a6ff",text:"#c9d1d9"}}],D="bulma-theme-flavor",T="catppuccin-mocha";function z(e){const f=Array.from(e.classList);for(const t of f)if(t.startsWith("theme-"))return t.substring(6);return null}function q(e){const t=e.documentElement?.getAttribute("data-baseurl")||"";try{const d=new URL(t,"http://localhost");return d.origin==="http://localhost"?d.pathname.replace(/\/$/,""):""}catch{return""}}async function S(e,f){const t=x.find(c=>c.id===f)||x.find(c=>c.id===T),d=q(e),m=e.getElementById("theme-flavor-trigger");m&&m.classList.add("is-loading");try{Array.from(e.documentElement.classList).forEach(p=>{p.startsWith("theme-")&&e.documentElement.classList.remove(p)}),e.documentElement.classList.add(`theme-${t.id}`);const n=`theme-${t.id}-css`;let s=e.getElementById(n);if(!s){s=e.createElement("link"),s.id=n,s.rel="stylesheet",s.type="text/css",s.setAttribute("data-theme-id",t.id);try{const p=d?`${window.location.origin}${d}/`:`${window.location.origin}/`,b=new URL(t.cssFile,p).pathname;s.href=b}catch{console.warn(`Invalid theme CSS path for ${t.id}`);return}e.head.appendChild(s);try{await new Promise((p,b)=>{const v=setTimeout(()=>{s.onload=null,s.onerror=null,b(new Error(`Theme ${t.id} load timeout`))},1e4);s.onload=()=>{clearTimeout(v),s.onload=null,s.onerror=null,p()},s.onerror=()=>{clearTimeout(v),s.onload=null,s.onerror=null,b(new Error(`Failed to load theme ${t.id}`))}})}catch(p){console.warn(`Theme CSS failed to load for ${t.id}:`,p)}}e.querySelectorAll('link[id^="theme-"][id$="-css"]').forEach(p=>{const b=p.id.replace("theme-","").replace("-css","");b!==t.id&&b!=="base"&&p.remove()});const o=e.getElementById("theme-flavor-trigger-icon");if(o&&t.icon)try{const p=d?`${window.location.origin}${d}/`:`${window.location.origin}/`,b=new URL(t.icon,p).pathname;if(o.src=b,o.alt=`${I[t.family].name} ${t.name}`,o.title=`${I[t.family].name} ${t.name}`,t.iconFallback){const v=new URL(t.iconFallback,p).pathname;o.onerror=()=>{o.onerror=null,o.src=v}}}catch{console.warn(`Invalid theme icon path for ${t.id}`)}e.querySelectorAll("#theme-flavor-menu .dropdown-item.theme-item").forEach(p=>{p.getAttribute("data-theme-id")===t.id?(p.classList.add("is-active"),p.setAttribute("aria-checked","true")):(p.classList.remove("is-active"),p.setAttribute("aria-checked","false"))})}finally{m&&m.classList.remove("is-loading")}}export async function initTheme(e,f){const t=f.__INITIAL_THEME__,d=f.localStorage.getItem(D)||T;if(t&&t===d&&z(e.documentElement)===d){const c=`theme-${d}-css`;e.getElementById(c)||await S(e,d);return}await S(e,d)}export function initNavbar(e){const f=e.location.pathname,t=e.querySelectorAll(".navbar-item");let d=null;const m=new Set;if(t.forEach(n=>{const s=n;if(s.href)try{const g=new URL(s.href).pathname,o=f.replace(/\/$/,"")||"/",L=g.replace(/\/$/,"")||"/";m.add(n),o===L&&(d=n)}catch{}}),t.forEach(n=>{if(n!==d&&m.has(n)){n.classList.remove("is-active");const s=n;s&&"removeAttribute"in s&&typeof s.removeAttribute=="function"&&s.removeAttribute("aria-current")}}),d){d.classList.add("is-active");const n=d;n&&"setAttribute"in n&&typeof n.setAttribute=="function"&&n.setAttribute("aria-current","page")}const c=e.querySelector('[data-testid="nav-reports"]');if(c){const n=["/coverage","/playwright","/lighthouse"],s=f.replace(/\/$/,"")||"/";n.some(o=>s===o||s.startsWith(o+"/"))?c.classList.add("is-active"):c.classList.remove("is-active")}}typeof window<"u"&&(window.initNavbar=initNavbar);export function wireFlavorSelector(e,f){const t=new AbortController,d=e.getElementById("theme-flavor-menu"),m=e.getElementById("theme-flavor-trigger"),c=m?.closest(".navbar-item.has-dropdown"),n=e.getElementById("theme-flavor-select"),s=q(e);if(!d||!m||!c)return{cleanup:()=>{t.abort()}};let g=-1;const o=[],L=f.localStorage.getItem(D)||z(e.documentElement)||T;if(n){for(;n.firstChild;)n.removeChild(n.firstChild);x.forEach(a=>{const r=e.createElement("option");r.value=a.id,r.textContent=a.name,a.id===L&&(r.selected=!0),n.appendChild(r)}),n.disabled=!1,n.addEventListener("change",a=>{const i=a.target?.value||T;f.localStorage.setItem(D,i),S(e,i).catch(l=>{console.error(`Failed to apply theme ${i}:`,l)})})}const p=Object.keys(I);let b=0;p.forEach(a=>{const r=x.filter(h=>h.family===a);if(r.length===0)return;const i=I[a],l=e.createElement("div");l.className="theme-family-group",l.setAttribute("role","group"),l.setAttribute("aria-labelledby",`theme-family-${a}`),l.style&&typeof l.style.setProperty=="function"&&l.style.setProperty("--animation-delay",`${b}ms`),b+=30;const k=e.createElement("div");k.className="theme-family-header",k.id=`theme-family-${a}`;const N=e.createElement("span");N.className="theme-family-name",N.textContent=i.name,k.appendChild(N),l.appendChild(k);const B=e.createElement("div");B.className="theme-family-items",r.forEach(h=>{const u=e.createElement("button");u.type="button",u.className="dropdown-item theme-item",u.setAttribute("data-theme-id",h.id),u.setAttribute("data-appearance",h.appearance),u.setAttribute("role","menuitemradio"),u.setAttribute("aria-label",`${i.name} ${h.name} (${h.appearance}). ${h.description}`),u.setAttribute("tabindex","-1");const R=h.id===L;u.setAttribute("aria-checked",String(R)),R&&u.classList.add("is-active");const y=e.createElement("img");if(y.className="theme-icon",h.icon){const A=f.location.origin,$=s?`${A}${s}/${h.icon}`:`${A}/${h.icon}`;if(y.src=$,y.alt=`${i.name} ${h.name}`,h.iconFallback){const G=s?`${A}${s}/${h.iconFallback}`:`${A}/${h.iconFallback}`;y.onerror=()=>{y.onerror=null,y.src=G}}}y.width=24,y.height=24,y.loading="lazy",u.appendChild(y);const F=e.createElement("div");F.className="theme-copy";const U=e.createElement("span");U.className="theme-title",U.textContent=`${i.name} \xB7 ${h.name}`,F.appendChild(U);const M=e.createElement("span");M.className="theme-description",M.textContent=h.description,F.appendChild(M),u.appendChild(F);const H=e.createElement("span");H.className="theme-check";const E=e.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttribute("width","16"),E.setAttribute("height","16"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.setAttribute("stroke","currentColor"),E.setAttribute("stroke-width","3"),E.setAttribute("stroke-linecap","round"),E.setAttribute("stroke-linejoin","round");const _=e.createElementNS("http://www.w3.org/2000/svg","polyline");_.setAttribute("points","20 6 9 17 4 12"),E.appendChild(_),H.appendChild(E),u.appendChild(H),u.addEventListener("click",A=>{if(A.preventDefault(),f.localStorage.setItem(D,h.id),C({restoreFocus:!0}),n){n.value=h.id;const $=new Event("change",{bubbles:!0});n.dispatchEvent($)}else S(e,h.id).catch($=>{console.error(`Failed to apply theme ${h.id}:`,$)})}),o.push(u),B.appendChild(u)}),l.appendChild(B),d.appendChild(l)});const v=a=>{m&&m.setAttribute("aria-expanded",String(a))},w=a=>{if(a<0||a>=o.length)return;const r=o[a];o.forEach(i=>{i.setAttribute("tabindex","-1")}),r.setAttribute("tabindex","0"),r.focus(),g=a},C=(a={})=>{const{restoreFocus:r=!0}=a;c&&c.classList.remove("is-active"),v(!1),o.forEach(i=>{i.setAttribute("tabindex","-1")}),g=-1,r&&m&&m.focus()},P=(a=!1)=>{if(!c)return;const r=c.classList.toggle("is-active");v(r),r?a&&o.length>0&&w(0):(g=-1,o.forEach(i=>{if(i&&typeof i.setAttribute=="function"){i.setAttribute("tabindex","-1");const l=i.classList&&typeof i.classList.contains=="function"?i.classList.contains("is-active"):!1;i.setAttribute("aria-checked",String(l))}}))};return m&&m.addEventListener("click",a=>{a.preventDefault(),P()},{signal:t.signal}),e.addEventListener("click",a=>{c&&!c.contains(a.target)&&C({restoreFocus:!1})},{signal:t.signal}),e.addEventListener("keydown",a=>{a.key==="Escape"&&c&&c.classList.contains("is-active")&&C({restoreFocus:!0})},{signal:t.signal}),m&&m.addEventListener("keydown",a=>{if(!c)return;const r=a.key;if(r==="Enter"||r===" "){a.preventDefault();const i=c.classList.contains("is-active");P(!i)}else if(r==="ArrowDown")if(a.preventDefault(),!c.classList.contains("is-active"))c.classList.add("is-active"),v(!0),w(0);else if(g<0)w(0);else{const i=g<o.length-1?g+1:0;w(i)}else if(r==="ArrowUp")if(a.preventDefault(),!c.classList.contains("is-active"))c.classList.add("is-active"),v(!0),w(o.length-1);else{const i=g<0?o.length-1:g,l=i>0?i-1:o.length-1;w(l)}},{signal:t.signal}),o.forEach((a,r)=>{a.addEventListener("keydown",i=>{const l=i.key;if(l==="ArrowDown"){i.preventDefault();const k=r<o.length-1?r+1:0;w(k)}else if(l==="ArrowUp"){i.preventDefault();const k=r>0?r-1:o.length-1;w(k)}else l==="Escape"?(i.preventDefault(),C()):l==="Enter"||l===" "?(i.preventDefault(),a.click()):l==="Home"?(i.preventDefault(),w(0)):l==="End"&&(i.preventDefault(),w(o.length-1))},{signal:t.signal})}),v(!1),c&&c.classList.remove("is-active"),{cleanup:()=>{t.abort()}}}export function enhanceAccessibility(e){e.querySelectorAll(".highlight > pre").forEach(t=>{t.hasAttribute("tabindex")||t.setAttribute("tabindex","0"),t.hasAttribute("role")||t.setAttribute("role","region"),t.hasAttribute("aria-label")||t.setAttribute("aria-label","Code block")})}typeof document<"u"&&typeof window<"u"&&document.addEventListener("DOMContentLoaded",()=>{initTheme(document,window).then(()=>{const{cleanup:e}=wireFlavorSelector(document,window);enhanceAccessibility(document);const f=()=>{e(),window.removeEventListener("pagehide",f)};window.addEventListener("pagehide",f)}).catch(e=>{console.error("Theme switcher initialization failed:",e)})});
