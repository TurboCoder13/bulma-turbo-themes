name: Monitoring - Uptime Check

on:
  workflow_dispatch:
    inputs:
      url:
        description: "URL to check"
        required: false
        default: "http://localhost:4000"
  schedule:
    - cron: "*/30 * * * *" # every 30 minutes

permissions:
  contents: read

concurrency:
  group: uptime
  cancel-in-progress: false

jobs:
  check:
    name: ðŸ’“ Health Check
    runs-on: ubuntu-24.04
    timeout-minutes: 5
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@c6295a65d1254861815972266d5933fd6e532bdf
        with:
          egress-policy: block
          allowed-endpoints: >
            github.com:443
            api.github.com:443
      - name: Resolve target URL
        id: vars
        run: ./scripts/ci/resolve-target-url.sh
      - name: Curl HEAD request
        run: ./scripts/ci/uptime-check.sh "${{ steps.vars.outputs.url }}"
        env:
          TARGET_URL: ${{ secrets.UPTIME_URL }}
