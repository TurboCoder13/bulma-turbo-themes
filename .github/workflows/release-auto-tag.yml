---
name: Release - Manual Tag Creation

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Version to tag (e.g., v1.2.3)"
        required: true
        type: string
      prerelease:
        description: "Mark as pre-release"
        required: false
        type: boolean
        default: false

permissions:
  contents: write

concurrency:
  group: manual-tag
  cancel-in-progress: false

jobs:
  create-tag:
    name: 🏷️ Create Git Tag
    runs-on: ubuntu-24.04
    timeout-minutes: 10
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@c6295a65d1254861815972266d5933fd6e532bdf
        with:
          egress-policy: block
          allowed-endpoints: >
            github.com:443
            api.github.com:443

      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 0

      - name: Validate version format
        run: ./scripts/ci/validate-version-format.sh "${{ inputs.version }}"

      - name: Check if tag already exists
        run: ./scripts/ci/check-tag-exists.sh "${{ inputs.version }}"

      - name: Create and push tag
        run: ./scripts/ci/create-and-push-tag.sh "${{ inputs.version }}" "${{ inputs.prerelease }}"

      - name: Summary
        run: ./scripts/ci/generate-tag-summary.sh "${{ inputs.version }}" "${{ inputs.prerelease }}"
